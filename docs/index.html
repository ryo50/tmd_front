<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <title>動画ダウンロード</title>
  </head>
  <body>
    <input type="text" id="targetUrl" placeholder="ページURLを入力" />
    <button id="downloadBtn">ダウンロード</button>

    <script>
      document
        .getElementById('downloadBtn')
        .addEventListener('click', async () => {
          const targetUrl = document.getElementById('targetUrl').value
          if (!targetUrl) return alert('URLを入力してください')

          try {
            const proxyUrl = `https://tmd-wb30.onrender.com/download?target=${encodeURIComponent(
              targetUrl
            )}`
            const res = await fetch(proxyUrl)
            if (!res.ok) throw new Error('ダウンロード失敗')

            const blob = await res.blob()
            const a = document.createElement('a')
            a.href = URL.createObjectURL(blob)
            a.download = 'video.mp4'
            a.click()
            a.remove()
          } catch (err) {
            console.error(err)
            alert('エラーが発生しました')
          }
        })
    </script>
  </body>
</html>
